#pragma config(Hubs,  S1, HTMotor,  HTMotor,  none,     none)
#pragma config(Hubs,  S2, HTServo,  none,     none,     none)
#pragma config(Sensor, S1,     ,               sensorI2CMuxController)
#pragma config(Sensor, S2,     ,               sensorI2CMuxController)
#pragma config(Motor,  motorA,          Claw,          tmotorNXT, PIDControl, encoder)
#pragma config(Motor,  mtr_S1_C1_1,     Wheel1,        tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C1_2,     Wheel2,        tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C2_1,     Wheel4,        tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C2_2,     Wheel3,        tmotorTetrix, openLoop, reversed)
#pragma config(Servo,  srvo_S2_C1_1,    W2Servo,              tServoStandard)
#pragma config(Servo,  srvo_S2_C1_2,    W1Servo,              tServoStandard)
#pragma config(Servo,  srvo_S2_C1_3,    W3Servo,              tServoStandard)
#pragma config(Servo,  srvo_S2_C1_4,    W4Servo,              tServoStandard)
#pragma config(Servo,  srvo_S2_C1_5,    servo5,               tServoNone)
#pragma config(Servo,  srvo_S2_C1_6,    servo6,               tServoNone)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "JoystickDriver.c"


int Mode;				//Let us know whether the wheels are in point Mode mode

int y1;
int y2;
int x1;
int x2;
int topHat;

int sequence;

int speed;
int turnSpeed;


void wheelsForward()
{
	servo[W2Servo] = 60;
	servo[W1Servo] = 75;
	servo[W3Servo] = 75;
	servo[W4Servo] = 60;
}
void wheelsSideways()
{
	servo[W2Servo] = 175;
	servo[W1Servo] = 200;
	servo[W3Servo] = 195;
	servo[W4Servo] = 185;
}
void wheelsTurning()
{
	servo[W2Servo] = 120;
	servo[W1Servo] = 25;
	servo[W3Servo] = 130;
	servo[W4Servo] = 250;
}

void goForward(int speed)
{
	motor[Wheel1] =	speed;
	motor[Wheel2] =	speed;
	motor[Wheel3] =	speed;
	motor[Wheel4] =	speed;
}
void goBackward(int speed)
{
	motor[Wheel1] =	-speed;
	motor[Wheel2] =	-speed;
	motor[Wheel3] =	-speed;
	motor[Wheel4] =	-speed;
}
void wheelStop()
{
	motor[Wheel1] =	0;
	motor[Wheel2] =	0;
	motor[Wheel3] =	0;
	motor[Wheel4] =	0;
}
void turnLeft(int speed)
{
	motor[Wheel1] =	-speed;
	motor[Wheel2] =	speed;
	motor[Wheel3] =	-speed;
	motor[Wheel4] =	-speed;
}
void turnRight(int speed)
{
	motor[Wheel1] =	speed;
	motor[Wheel2] =	-speed;
	motor[Wheel3] =	speed;
	motor[Wheel4] =	speed;

}

task main()
{
	bPlaySounds = true;

	topHat = joystick.joy1_TopHat;
	//int serv1 = servo[W1Servo];
	//int serv2 = servo[W2Servo];
	//int serv3 = servo[W3Servo];
	//int serv4 = servo[W4Servo];

	sequence = 0;

	while(true)
	{
		getJoystickSettings(joystick);

		speed = 40;
		turnSpeed = 80;


		//joystick variable shortcuts
		y1 = joystick.joy1_y1;
		y2 = joystick.joy1_y2;
		x1 = joystick.joy1_x1;
		x2 = joystick.joy1_x2;


		//CHANGING MODES AND WHEELS
		if(joy1Btn(4) == 1)   //Button 4 turn all wheels forward
		{
			wheelsForward();

			Mode = 0;
		}
		if(joy1Btn(1) == 1)		//Button 1 turn all wheels Left
		{
			wheelsSideways();

			Mode = 0;
		}
		if(joy1Btn(5) == 1)
		{
			servo[W2Servo] = 125; 	//wheel 4 wheel2
			servo[W1Servo] = 140;
			servo[W3Servo] = 135;
			servo[W4Servo] = 125;
			//servo[W2Servo] = 225;
			//servo[W1Servo] = 250;
			//servo[W3Servo] = 250;
			//servo[W4Servo] = 240;
			Mode = 2;
		}
		if(joy1Btn(6) == 1)
		{
			servo[W2Servo] = 5;
			servo[W1Servo] = 15;
			servo[W3Servo] = 15;
			servo[W4Servo] = 0;
			Mode = 2;
		}
		if(joy1Btn(3) == 1)		//Button 3 turns all wheels to prepare for point turning Mode
		{
			wheelsTurning();

			Mode = 1;
		}
		//TANK DRIVE MODE
		if(joy1Btn(10) == 1)
		{
			servo[W2Servo] = 60;
			servo[W1Servo] = 75;
			servo[W3Servo] = 75;
			servo[W4Servo] = 60;

			Mode = 3;
		}


		//CHANGING WHEELS ORIENTATION USING JOYSTICK
		if(time1[T1] >= 5 && Mode != 3)
		{
			if(x2 < -10 && servo[W2Servo] <= 225 && servo[W1Servo] <= 250 && servo[W3Servo] <= 250 && servo[W4Servo] <= 240)
			{
				servo[W2Servo] += 1;
				servo[W1Servo] += 1;
				servo[W3Servo] += 1;
				servo[W4Servo] += 1;
				ClearTimer(T1);
			}
			else if(x2 > 10 && servo[W2Servo] >= 5 && servo[W1Servo] >= 15 && servo[W3Servo] >= 15 && servo[W4Servo] >= 0)
			{
				servo[W2Servo] -= 1;
				servo[W1Servo] -= 1;
				servo[W3Servo] -= 1;
				servo[W4Servo] -= 1;

				ClearTimer(T1);
			}
		}
		//DRIVING MODES
		if(Mode == 0)
		{
		motor[Wheel1] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel2] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel3] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel4] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		}

		if(Mode == 1)						//While in point Mode mode, reverse the 2nd wheel to make it go same direction with the rest of the wheels
		{
		motor[Wheel1] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel2] =	-(y1 < -10? y1 : y1 > 10? y1 : 0);
		motor[Wheel3] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel4] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		}
		if(Mode == 2)
		{
		motor[Wheel1] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel2] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel3] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		motor[Wheel4] =	y1 < -10? y1 : y1 > 10? y1 : 0;
		}
		if(Mode == 3)
		{
		motor[Wheel1] =	y1 < -10? y1 : y1 > 10? y1 : 0;//left
		motor[Wheel2] =	y2 < -10? y2 : y2 > 10? y2 : 0;
		motor[Wheel3] =	y1 < -10? y1 : y1 > 10? y1 : 0;//left
		motor[Wheel4] =	y2 < -10? y2 : y2 > 10? y2 : 0;

		}





		//if(time1[T2] >= 200)
		//{
		//	writeDebugStreamLine("Servo 1: %n", serv1);
		//	writeDebugStreamLine("Servo 2: %n", serv2);
		//	writeDebugStreamLine("Servo 3: %n", serv3);
		//	writeDebugStreamLine("Servo 4: %n", serv4);
		//	ClearTimer(T2);
		//}
		if(joy1Btn(7) == 1)
		{
			motor[Claw] = 20;
		}
		else if(joy1Btn(8) == 1)
		{
			motor[Claw] = -20;
		}

		else	if(joy1Btn(7) == 0)
		{
			motor[Claw] = 0;
		}
		else if(joy1Btn(8) == 0)
		{
			motor[Claw] = 0;
		}


		////Easter Egg dance edition
		//if(joystick.joy1_TopHat == 0)
		//{
		//	//ClearTimer(T2);
		//	//sequence = 1;
		//	PlaySound(soundBeepBeep);
		//}
		//if(joystick.joy1_TopHat == 2 && time1[T2] >= 100 && sequence == 1)
		//{
		//	ClearTimer(T2);
		//	sequence = 2;
		//	PlaySound(soundBeepBeep);
		//}
		//if(joystick.joy1_TopHat == 4 && time1[T2] >= 100 && sequence == 2)
		//{
		//	ClearTimer(T2);
		//	sequence = 3;
		//	PlaySound(soundBeepBeep);
		//}






		if(joy1Btn(9) == 1)
		{
			PlaySound(soundBeepBeep);
			wheelsForward();
			wait1Msec(200);

			PlaySound(soundUpwardTones);
			goForward(speed);	//Move forward
			wait1Msec(1000);
			wheelStop();
			wait1Msec(50);

			PlaySound(soundDownwardTones);
			goBackward(speed);	//Move backward
			wait1Msec(1000);
			wheelStop();
			wait1Msec(50);

			wheelsTurning();
			wait1Msec(200);

			PlaySound(soundException);
			turnLeft(turnSpeed);	//Turn left
			wait1Msec(750);
			wheelStop();
			wait1Msec(50);

			PlaySound(soundLowBuzz);
			turnRight(turnSpeed);		//Turn right
			wait1Msec(750);
			wheelStop();
			wait1Msec(50);
			PlaySound(soundBeepBeep);
		}
	}
}
